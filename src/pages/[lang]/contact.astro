---
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import { getStaticPaths as getI18nStaticPaths } from '../../lib/i18n/utils';
import { useTranslations, type Language } from '../../lib/i18n/languages';

export function getStaticPaths() {
	return getI18nStaticPaths();
}

const { lang } = Astro.params as { lang: Language };
const t = useTranslations(lang);
---

<!doctype html>
<html lang={lang}>
	<head>
		<BaseHead title={t('nav.contact')} description={t('site.description')} />
	</head>
	<body>
		<Header lang={lang} />
		<main class="max-w-4xl mx-auto px-4 py-12">
			<h1 class="text-4xl font-bold mb-8">{t('nav.contact')}</h1>

			<div class="prose prose-lg max-w-none mb-12">
				{lang === 'ko' ? (
					<div>
						<p class="text-lg mb-6">
							EffiFlow에 관심을 가져주셔서 감사합니다. 궁금하신 점이나 문의사항이 있으시면 언제든지 연락 주세요.
						</p>
					</div>
				) : lang === 'ja' ? (
					<div>
						<p class="text-lg mb-6">
							EffiFlowにご興味をお持ちいただき、ありがとうございます。ご質問やお問い合わせがございましたら、お気軽にご連絡ください。
						</p>
					</div>
				) : lang === 'zh' ? (
					<div>
						<p class="text-lg mb-6">
							感谢您对EffiFlow的关注。如有任何疑问或咨询事项，请随时与我们联系。
						</p>
					</div>
				) : (
					<div>
						<p class="text-lg mb-6">
							Thank you for your interest in EffiFlow. If you have any questions or inquiries, please feel free to contact us.
						</p>
					</div>
				)}
			</div>
			
			<!-- Embedded Form -->
			<div class="bg-gray-50 rounded-lg p-8">
				<iframe
					src="https://docs.google.com/forms/d/e/1FAIpQLScrrwaSvM0oJ20MghN7-K463SbfxlSGyBwuiTpADlYI4iHclA/viewform?embedded=true"
					width="100%"
					height="1000"
					frameborder="0"
					marginheight="0"
					marginwidth="0"
					class="rounded-lg">
					Loading…
				</iframe>
			</div>
		</main>
		<Footer lang={lang} />

		<!-- Contact Form Interaction Tracking -->
		<script is:inline>
			let contactTracked = false;

			console.log('[GA Debug] Contact form tracking initialized');

			function trackContactInteraction() {
				if (contactTracked) {
					console.log('[GA Debug] Contact already tracked, skipping');
					return;
				}
				contactTracked = true;

				console.log('[GA Debug] Contact form interaction detected');

				// Send GA4 event
				if (typeof gtag !== 'undefined') {
					const eventData = {
						'page_title': document.title,
						'page_location': window.location.href,
						'page_path': window.location.pathname,
						'event_category': 'engagement',
						'event_label': 'contact_form_interaction'
					};
					console.log('[GA Debug] Sending contact_button_click event:', eventData);
					gtag('event', 'contact_button_click', eventData);
					console.log('[GA Debug] Event sent successfully');
				} else {
					console.warn('[GA Debug] gtag is not defined');
				}
			}

			// Track when user clicks on the iframe
			const iframe = document.querySelector('iframe');
			if (iframe) {
				console.log('[GA Debug] Iframe found, attaching listeners');
				iframe.addEventListener('load', () => {
					console.log('[GA Debug] Iframe loaded');
					// Track iframe focus (user interaction)
					window.addEventListener('blur', () => {
						if (document.activeElement === iframe) {
							console.log('[GA Debug] Iframe focused (user clicked)');
							trackContactInteraction();
						}
					});
				});
			} else {
				console.warn('[GA Debug] Iframe not found');
			}
		</script>
	</body>
</html>
