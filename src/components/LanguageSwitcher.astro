---
import { languages, type Language } from '../lib/i18n/languages';
import { getRouteFromUrl } from '../lib/i18n/utils';

interface Props {
	currentLang: Language;
}

const { currentLang } = Astro.props;
const currentRoute = getRouteFromUrl(Astro.url.pathname);
---

<div class="language-selector-wrapper">
	<svg class="language-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
		<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
	</svg>
	<select
		id="language-selector"
		class="language-selector"
		aria-label="Select language"
	>
		{Object.entries(languages).map(([lang, label]) => (
			<option
				value={`/${lang}${currentRoute.replace(/{LANG}/g, lang)}`}
				selected={lang === currentLang}
			>
				{label}
			</option>
		))}
	</select>
</div>

<style>
	.language-selector-wrapper {
		position: relative;
		display: flex;
		align-items: center;
		gap: 0.375rem;
	}

	.language-icon {
		width: 1.125rem;
		height: 1.125rem;
		color: #6B7280;
		pointer-events: none;
	}

	.language-selector {
		appearance: none;
		background-color: transparent;
		border: 1px solid #E5E7EB;
		border-radius: 0.375rem;
		padding: 0.375rem 1.75rem 0.375rem 0.625rem;
		font-size: 0.875rem;
		font-weight: 500;
		color: #374151;
		cursor: pointer;
		transition: all 0.2s ease;
		background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236B7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
		background-repeat: no-repeat;
		background-position: right 0.375rem center;
		background-size: 1rem;
	}

	.language-selector:hover {
		border-color: #f97316;
		background-color: #FFF7ED;
	}

	.language-selector:focus {
		outline: 2px solid #f97316;
		outline-offset: 2px;
		border-color: #f97316;
	}

	@media (max-width: 720px) {
		.language-selector {
			padding: 0.25rem 1.5rem 0.25rem 0.5rem;
			font-size: 0.8125rem;
		}

		.language-icon {
			width: 1rem;
			height: 1rem;
		}
	}
</style>

<script>
	const languageSelector = document.getElementById('language-selector') as HTMLSelectElement;

	languageSelector?.addEventListener('change', (e) => {
		const target = e.target as HTMLSelectElement;
		window.location.href = target.value;
	});
</script>
