---
import type { Language } from '../lib/i18n/languages';
import { getCollection } from 'astro:content';

interface Props {
  slug: string;
  currentLang: Language;
}

const { slug, currentLang } = Astro.props;

const languages: Record<string, { flag: string; label: string; currentLabel: string }> = {
  ko: { flag: 'ğŸ‡°ğŸ‡·', label: 'í•œêµ­ì–´', currentLabel: 'í•œêµ­ì–´ (í˜„ì¬ í˜ì´ì§€)' },
  ja: { flag: 'ğŸ‡¯ğŸ‡µ', label: 'æ—¥æœ¬èª', currentLabel: 'æ—¥æœ¬èªï¼ˆç¾åœ¨ã®ãƒšãƒ¼ã‚¸ï¼‰' },
  en: { flag: 'ğŸ‡ºğŸ‡¸', label: 'English', currentLabel: 'English (Current Page)' },
  zh: { flag: 'ğŸ‡¨ğŸ‡³', label: 'ä¸­æ–‡', currentLabel: 'ä¸­æ–‡ï¼ˆå½“å‰é¡µé¢ï¼‰' }
};

const sectionTitles: Record<Language, string> = {
  ko: 'ë‹¤ë¥¸ ì–¸ì–´ë¡œ ì½ê¸°',
  ja: 'ä»–ã®è¨€èªã§èª­ã‚€',
  en: 'Read in Other Languages',
  zh: 'é˜…è¯»å…¶ä»–è¯­è¨€ç‰ˆæœ¬'
};

// Get all blog posts and check which language versions exist for this slug
const allPosts = await getCollection('blog');
const availableLanguages = Object.keys(languages).filter(lang => {
  // Check if a post exists for this language and slug
  return allPosts.some(post => post.id === `${lang}/${slug}.md` || post.id === `${lang}/${slug}`);
});
---

<div class="blog-post-language-switcher">
  <h2>{sectionTitles[currentLang]}</h2>
  <ul>
    {availableLanguages.map((lang) => {
      const { flag, label, currentLabel } = languages[lang];
      return (
        <li>
          {lang === currentLang ? (
            <span class="current-language">
              {flag} {currentLabel}
            </span>
          ) : (
            <a href={`/${lang}/blog/${lang}/${slug}`}>
              {flag} {label}
            </a>
          )}
        </li>
      );
    })}
  </ul>
</div>

<style>
  .blog-post-language-switcher {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--gray-200);
  }

  .blog-post-language-switcher h2 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }

  .blog-post-language-switcher ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .blog-post-language-switcher li {
    margin: 0;
  }

  .blog-post-language-switcher a {
    color: var(--accent);
    text-decoration: none;
    transition: opacity 0.2s;
  }

  .blog-post-language-switcher a:hover {
    opacity: 0.7;
  }

  .current-language {
    color: var(--gray-600);
  }
</style>
