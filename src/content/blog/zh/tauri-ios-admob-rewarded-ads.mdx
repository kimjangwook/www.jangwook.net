---
title: 'åœ¨ Tauri 2.x iOS åº”ç”¨ä¸­é›†æˆ AdMob æ¿€åŠ±å¹¿å‘Šï¼šSwift æ’ä»¶å¼€å‘æŒ‡å—'
description: 'å®Œæ•´æŒ‡å—ï¼šåœ¨ Tauri v2 iOS åº”ç”¨ä¸­é›†æˆ Google AdMob æ¿€åŠ±å¹¿å‘Šã€‚ç”±äºæ²¡æœ‰å®˜æ–¹æ’ä»¶ï¼Œåˆ†äº«è‡ªä¸»å¼€å‘ Swift æ’ä»¶çš„å…¨è¿‡ç¨‹ã€‚'
pubDate: '2026-01-30'
heroImage: ../../../assets/portfolio/shadow-dash/app_icon.jpg
tags:
  - tauri
  - admob
  - ios
  - swift
relatedPosts:
  - slug: "tauri-pixijs-ios-game-development"
    score: 0.92
    reason:
      ko: "Taurië¡œ iOS ê²Œì„ì„ ê°œë°œí•˜ëŠ” ì „ì²´ ê³¼ì •ì„ ë‹¤ë£¨ë©°, ì´ í¬ìŠ¤íŠ¸ì˜ ì„ í–‰ ì§€ì‹ì´ ë©ë‹ˆë‹¤"
      ja: "Tauriã§iOSã‚²ãƒ¼ãƒ ã‚’é–‹ç™ºã™ã‚‹å…¨éç¨‹ã‚’æ‰±ã„ã€ã“ã®è¨˜äº‹ã®å‰æçŸ¥è­˜ã¨ãªã‚Šã¾ã™"
      en: "Covers the entire process of developing iOS games with Tauri, serving as prerequisite knowledge for this post"
      zh: "æ¶µç›–ä½¿ç”¨Tauriå¼€å‘iOSæ¸¸æˆçš„å®Œæ•´è¿‡ç¨‹ï¼Œæ˜¯æœ¬æ–‡çš„å‰ç½®çŸ¥è¯†"
  - slug: "individual-developer-ai-saas-journey"
    score: 0.78
    reason:
      ko: "ê°œì¸ ê°œë°œìì˜ ì•± ìˆ˜ìµí™” ì—¬ì •ìœ¼ë¡œ, ìˆ˜ìµ ëª¨ë¸ ì„¤ê³„ì— ì°¸ê³ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
      ja: "å€‹äººé–‹ç™ºè€…ã®ã‚¢ãƒ—ãƒªåç›ŠåŒ–ã®æ—…ã§ã€åç›Šãƒ¢ãƒ‡ãƒ«è¨­è¨ˆã®å‚è€ƒã«ãªã‚Šã¾ã™"
      en: "Individual developer's app monetization journey, useful reference for revenue model design"
      zh: "ä¸ªäººå¼€å‘è€…çš„åº”ç”¨å˜ç°ä¹‹æ—…ï¼Œå¯ä½œä¸ºæ”¶ç›Šæ¨¡å‹è®¾è®¡çš„å‚è€ƒ"
  - slug: "claude-code-plugins-complete-guide"
    score: 0.72
    reason:
      ko: "í”ŒëŸ¬ê·¸ì¸ ì•„í‚¤í…ì²˜ì™€ ê°œë°œ ë°©ë²•ë¡ ì—ì„œ ìœ ì‚¬í•œ ì ‘ê·¼ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤"
      ja: "ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨é–‹ç™ºæ–¹æ³•è«–ã§é¡ä¼¼ã—ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ‰±ã„ã¾ã™"
      en: "Covers similar approaches in plugin architecture and development methodology"
      zh: "åœ¨æ’ä»¶æ¶æ„å’Œå¼€å‘æ–¹æ³•è®ºæ–¹é¢æ¶µç›–äº†ç±»ä¼¼çš„æ–¹æ³•"
---

import { Image } from 'astro:assets';
import screenshot01 from '../../../assets/portfolio/shadow-dash/shadow-dash-01_iphone.png';
import screenshot04 from '../../../assets/portfolio/shadow-dash/shadow-dash-04_iphone.png';

## æ¦‚è¿°

æ‚¨ä½¿ç”¨ Tauri 2.x å¼€å‘äº†ä¸€ä¸ª iOS åº”ç”¨ï¼Œç°åœ¨æƒ³è¦é€šè¿‡ AdMob å¹¿å‘Šæ¥å˜ç°ã€‚è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

é—æ†¾çš„æ˜¯ï¼Œ**Tauri æ²¡æœ‰å®˜æ–¹çš„ AdMob æ’ä»¶**ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†åˆ†äº«å¼€å‘è‡ªå®šä¹‰ Swift æ’ä»¶æ¥é›†æˆ AdMob æ¿€åŠ±å¹¿å‘Šçš„å®Œæ•´è¿‡ç¨‹ã€‚

> æœ¬æ–‡æ˜¯ [ä½¿ç”¨ Tauri + PixiJS å¼€å‘ iOS æ¸¸æˆ](/zh/blog/zh/tauri-pixijs-ios-game-development) çš„ç»­ç¯‡ã€‚åŸºäºåœ¨ Shadow Dash æ¸¸æˆä¸­é›†æˆå¹¿å‘Šçš„å®é™…ç»éªŒæ’°å†™ã€‚

<Image src={screenshot04} alt="Shadow Dash æ¸¸æˆç»“æŸç”»é¢" width={300} class="mx-auto rounded-lg shadow-lg" />

## ä¸ºä»€ä¹ˆé€‰æ‹© AdMobï¼Ÿ

### æ‰‹æ¸¸å˜ç°æ–¹å¼å¯¹æ¯”

| æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| **æ¿€åŠ±å¹¿å‘Š** | ç”¨æˆ·ä½“éªŒå¥½ï¼Œé«˜ eCPM | å®ç°å¤æ‚ |
| æ¨ªå¹…å¹¿å‘Š | å®ç°ç®€å• | ä½ eCPMï¼Œå½±å“ä½“éªŒ |
| åº”ç”¨å†…è´­ä¹° | é«˜æ”¶ç›Š | å®ç°å¤æ‚ï¼Œæ”¯ä»˜å®¡æ ¸ |

### ä¸ºä»€ä¹ˆé€‰æ‹©æ¿€åŠ±å¹¿å‘Š

åœ¨ Shadow Dash ä¸­ï¼Œæˆ‘å°†æ¿€åŠ±å¹¿å‘Šåº”ç”¨äº**ç»­å‘½ç³»ç»Ÿ**ï¼š

```mermaid
graph LR
    A[æ¸¸æˆç»“æŸ] --> B["è§‚çœ‹å¹¿å‘Šç»§ç»­æ¸¸æˆ"æŒ‰é’®]
    B --> C[è§‚çœ‹å¹¿å‘Š]
    C --> D[ç»§ç»­æ¸¸æˆ]
```

ç”¨æˆ·**è‡ªæ„¿**è§‚çœ‹å¹¿å‘Šå¹¶è·å¾—å¥–åŠ±ï¼ˆç»§ç»­æ¸¸æˆï¼‰ï¼Œè¿™ç§ç»“æ„ä¸ä¼šæŸå®³ç”¨æˆ·ä½“éªŒã€‚

### å¹¿å‘Š SDK é€‰æ‹©è¿‡ç¨‹

æˆ‘è¯„ä¼°äº† Tauri åº”ç”¨å¯ç”¨çš„å¹¿å‘Š SDKï¼š

| SDK | ä¼˜ç‚¹ | ç¼ºç‚¹ | å†³å®š |
|-----|------|------|------|
| **AdMob** | é«˜ eCPMï¼Œå¤šç§å¹¿å‘Šæ ¼å¼ | éœ€è¦åŸç”Ÿæ’ä»¶ | âœ… é‡‡ç”¨ |
| AppLixir | ä»…éœ€ JS SDK é›†æˆ | **éœ€è¦ 5,000+ DAU** | âŒ æœªé‡‡ç”¨ |
| H5 Game Ads | HTML5 æ¸¸æˆä¸“ç”¨ | **Beta æœåŠ¡ï¼ˆä¸ç¨³å®šï¼‰** | âŒ æœªé‡‡ç”¨ |

**ä¸ºä»€ä¹ˆä¸é€‰æ‹© AppLixir**ï¼š
- éœ€è¦æœ€å°‘ 5,000 æ—¥æ´»è·ƒç”¨æˆ·ï¼ˆDAUï¼‰æ‰èƒ½ç”³è¯·
- æ–°åº”ç”¨å¾ˆéš¾æ»¡è¶³è¿™ä¸ªæ¡ä»¶

**ä¸ºä»€ä¹ˆä¸é€‰æ‹© H5 Game Ads**ï¼š
- ä»å¤„äº Beta æœåŠ¡é˜¶æ®µ
- ç¨³å®šæ€§å’Œæ”¶ç›Šæ€§å°šæœªéªŒè¯

### AdMob vs AppLixir è¯¦ç»†å¯¹æ¯”

å¯¹æ¯” AdMob å’Œ AppLixir çš„æ€§èƒ½ï¼š

| é¡¹ç›® | AdMob | AppLixir |
|------|-------|----------|
| eCPMï¼ˆæ¿€åŠ±ï¼‰ | $20ã€œ30 | $15ã€œ25 |
| Fill Rate | 95%+ | 80ã€œ90% |
| æ”¯æŒæ ¼å¼ | æ¿€åŠ±ã€æ’é¡µã€æ¨ªå¹… | ä»…æ¿€åŠ± |
| Mediation | æ”¯æŒ | ä¸æ”¯æŒ |
| é›†æˆéš¾åº¦ | é«˜ï¼ˆéœ€è¦åŸç”Ÿï¼‰ | ä½ï¼ˆJS SDKï¼‰ |
| å‡†å…¥é—¨æ§› | æ—  | éœ€è¦ 5,000+ DAU |

**ç»“è®º**ï¼šè™½ç„¶éœ€è¦åŸç”Ÿæ’ä»¶å¼€å‘ï¼Œä½† AdMob æ²¡æœ‰å‡†å…¥é—¨æ§›ï¼Œå¹¶æä¾›æ›´é«˜çš„ eCPM å’Œ Fill Rateã€‚

---

## å‡çº§ Tauri CLI

### éœ€è¦ XCFramework æ”¯æŒ

åœ¨ Tauri v2 ä¸­å¼€å‘ iOS æ’ä»¶éœ€è¦ä½¿ç”¨ Swift Package Managerï¼ˆSPMï¼‰ã€‚å¯¹äºéœ€è¦å¤–éƒ¨æ¡†æ¶ä¾èµ–ï¼ˆå¦‚ GoogleMobileAds SDKï¼‰çš„æ’ä»¶ï¼Œéœ€è¦ **XCFramework æ”¯æŒ**ã€‚

### å‡çº§åˆ° Tauri CLI 2.9.6+

```bash
# é€šè¿‡ Cargo å‡çº§ Tauri CLI
cargo install tauri-cli --force

# éªŒè¯ç‰ˆæœ¬
cargo tauri --version
# è¾“å‡º: tauri-cli 2.9.6ï¼ˆæˆ–æ›´é«˜ï¼‰
```

### --ios-framework é€‰é¡¹

åˆ›å»ºæ’ä»¶æ—¶å¯ä»¥æŒ‡å®š iOS æ¡†æ¶ç±»å‹ï¼š

```bash
# Xcode é¡¹ç›®æ–¹å¼ï¼ˆä¾¿äºæ·»åŠ  SPM ä¾èµ–ï¼‰- æ¨è
cargo tauri plugin new admob --ios --ios-framework xcode

# XCFramework æ–¹å¼
cargo tauri plugin new admob --ios --ios-framework xcframework
```

| é€‰é¡¹ | è¯´æ˜ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| `xcode` | åˆ›å»º Xcode é¡¹ç›® | ä¾¿äºé€šè¿‡ SPM æ·»åŠ ä¾èµ– | éœ€è¦ç®¡ç†é¡¹ç›®æ–‡ä»¶ |
| `xcframework` | åˆ›å»º XCFramework | ä¾¿äºåˆ†å‘ | å¤–éƒ¨ä¾èµ–æ·»åŠ å¤æ‚ |

**AdMob æ’ä»¶æ¨èä½¿ç”¨ `xcode` é€‰é¡¹**ï¼šå¯ä»¥é€šè¿‡ SPM è½»æ¾æ·»åŠ  GoogleMobileAds SDKã€‚

---

## ç†è§£ Tauri æ’ä»¶ç»“æ„

### ç›®å½•ç»“æ„

```
tauri-plugin-admob/
â”œâ”€â”€ src/                    # Rust ä»£ç 
â”‚   â”œâ”€â”€ lib.rs             # æ’ä»¶å…¥å£ç‚¹
â”‚   â”œâ”€â”€ mobile.rs          # iOS/Android æ¡¥æ¥
â”‚   â”œâ”€â”€ desktop.rs         # æ¡Œé¢ç«¯å­˜æ ¹
â”‚   â”œâ”€â”€ commands.rs        # Tauri å‘½ä»¤
â”‚   â””â”€â”€ models.rs          # è¯·æ±‚/å“åº”ç±»å‹
â”œâ”€â”€ ios/                    # iOS åŸç”Ÿä»£ç 
â”‚   â””â”€â”€ tauri-plugin-admob/
â”‚       â””â”€â”€ AdmobPlugin.swift
â”œâ”€â”€ guest-js/              # TypeScript API
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ permissions/           # Tauri æƒé™è®¾ç½®
â”‚   â””â”€â”€ default.toml
â”œâ”€â”€ build.rs               # æ„å»ºè„šæœ¬
â””â”€â”€ Cargo.toml
```

### æ•°æ®æµ

```mermaid
graph TD
    A[TypeScript] -->|invoke| B[Rust Command]
    B -->|run_mobile_plugin| C[Swift Plugin]
    C -->|API Call| D[GoogleMobileAds SDK]
    D -->|Response| C
    C -->|Result| B
    B -->|JSON| A
```

---

## å¼€å§‹æ’ä»¶å¼€å‘

### æ’ä»¶è„šæ‰‹æ¶

```bash
# ä½¿ç”¨ Xcode é¡¹ç›®æ–¹å¼åˆ›å»º
cargo tauri plugin new admob --ios --ios-framework xcode
```

### æ·»åŠ  GoogleMobileAds SDK

åœ¨ Xcode ä¸­æ‰“å¼€æ’ä»¶é¡¹ç›®ï¼Œé€šè¿‡ Swift Package Manager æ·»åŠ  SDKï¼š

1. æ‰“å¼€ `tauri-plugin-admob/ios/tauri-plugin-admob.xcodeproj`
2. **File â†’ Add Package Dependencies**
3. è¾“å…¥ URLï¼š`https://github.com/googleads/swift-package-manager-google-mobile-ads`
4. é€‰æ‹© **GoogleMobileAds** å¹¶æ·»åŠ 

---

## Swift æ’ä»¶å®ç°

### AdmobPlugin.swift

```swift
import SwiftRs
import Tauri
import UIKit
import WebKit
import GoogleMobileAds

// MARK: - Argument Types
class InitializeArgs: Decodable {}

class LoadRewardedArgs: Decodable {
    let adUnitId: String
}

class ShowRewardedArgs: Decodable {}

// MARK: - AdMob Plugin
class AdmobPlugin: Plugin {
    private var rewardedAd: GADRewardedAd?
    private var isInitialized = false
    private var pendingInvoke: Invoke?

    // æµ‹è¯•å¹¿å‘Š IDï¼ˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨å®é™… IDï¼‰
    private let testAdUnitId = "ca-app-pub-3940256099942544/1712485313"

    @objc public override func load(webview: WKWebView) {
        NSLog("[AdMob Plugin] Loaded")
    }

    // SDK åˆå§‹åŒ–
    @objc public func initialize(_ invoke: Invoke) {
        if isInitialized {
            invoke.resolve(["success": true, "message": "Already initialized"])
            return
        }

        GADMobileAds.sharedInstance().start { status in
            self.isInitialized = true
            NSLog("[AdMob Plugin] SDK Initialized")
            invoke.resolve(["success": true, "message": "SDK initialized"])
        }
    }

    // åŠ è½½æ¿€åŠ±å¹¿å‘Š
    @objc public func loadRewardedAd(_ invoke: Invoke) {
        do {
            let args = try invoke.parseArgs(LoadRewardedArgs.self)
            let adUnitId = args.adUnitId.isEmpty ? testAdUnitId : args.adUnitId

            let request = GADRequest()
            GADRewardedAd.load(withAdUnitID: adUnitId, request: request) { [weak self] ad, error in
                if let error = error {
                    invoke.resolve(["success": false, "error": error.localizedDescription])
                    return
                }

                self?.rewardedAd = ad
                self?.rewardedAd?.fullScreenContentDelegate = self
                invoke.resolve(["success": true])
            }
        } catch {
            invoke.reject(error.localizedDescription)
        }
    }

    // æ£€æŸ¥å¹¿å‘Šæ˜¯å¦å°±ç»ª
    @objc public func isRewardedAdReady(_ invoke: Invoke) {
        let isReady = rewardedAd != nil
        invoke.resolve(["ready": isReady])
    }

    // æ˜¾ç¤ºå¹¿å‘Š
    @objc public func showRewardedAd(_ invoke: Invoke) {
        guard let rewardedAd = rewardedAd else {
            invoke.resolve(["success": false, "rewarded": false, "error": "No ad loaded"])
            return
        }

        guard let rootViewController = getRootViewController() else {
            invoke.resolve(["success": false, "rewarded": false, "error": "No root view controller"])
            return
        }

        pendingInvoke = invoke

        DispatchQueue.main.async {
            rewardedAd.present(fromRootViewController: rootViewController) { [weak self] in
                let reward = rewardedAd.adReward
                if let pending = self?.pendingInvoke {
                    pending.resolve([
                        "success": true,
                        "rewarded": true,
                        "rewardAmount": reward.amount.intValue,
                        "rewardType": reward.type
                    ])
                    self?.pendingInvoke = nil
                }
            }
        }
    }

    // è·å– Root View Controller
    private func getRootViewController() -> UIViewController? {
        if let windowScene = UIApplication.shared.connectedScenes
            .compactMap({ $0 as? UIWindowScene })
            .first(where: { $0.activationState == .foregroundActive }),
           let keyWindow = windowScene.windows.first(where: { $0.isKeyWindow }),
           let rootVC = keyWindow.rootViewController {
            var topController = rootVC
            while let presented = topController.presentedViewController {
                topController = presented
            }
            return topController
        }
        return nil
    }
}

// MARK: - GADFullScreenContentDelegate
extension AdmobPlugin: GADFullScreenContentDelegate {
    func adDidDismissFullScreenContent(_ ad: GADFullScreenPresentingAd) {
        rewardedAd = nil
        if let pending = pendingInvoke {
            pending.resolve(["success": true, "rewarded": false])
            pendingInvoke = nil
        }
    }

    func ad(_ ad: GADFullScreenPresentingAd, didFailToPresentFullScreenContentWithError error: Error) {
        rewardedAd = nil
        if let pending = pendingInvoke {
            pending.resolve(["success": false, "rewarded": false, "error": error.localizedDescription])
            pendingInvoke = nil
        }
    }
}

// MARK: - Plugin Export
@_cdecl("init_plugin_admob")
func initPlugin() -> Plugin {
    return AdmobPlugin()
}
```

### å…³é”®ç‚¹

1. **`@objc` æ³¨è§£**ï¼šé€šè¿‡ Objective-C è¿è¡Œæ—¶æš´éœ²ç»™ Rust è°ƒç”¨
2. **`pendingInvoke` æ¨¡å¼**ï¼šå°†å¼‚æ­¥å¹¿å‘Šå›è°ƒæ¡¥æ¥åˆ° Tauri çš„åŒæ­¥ invoke æ¨¡å¼
3. **`GADFullScreenContentDelegate`**ï¼šå¤„ç†å¹¿å‘Šå…³é—­/é”™è¯¯äº‹ä»¶
4. **`@_cdecl("init_plugin_admob")`**ï¼šä¸º Rust æ’ä»¶åŠ è½½å¯¼å‡º C å‡½æ•°

---

## Rust æ¡¥æ¥å®ç°

### models.rs

```rust
use serde::{Deserialize, Serialize};

#[derive(Debug, Clone, Default, Deserialize, Serialize)]
#[serde(rename_all = "camelCase")]
pub struct InitializeResponse {
    pub success: bool,
    pub message: Option<String>,
}

#[derive(Debug, Deserialize, Serialize)]
#[serde(rename_all = "camelCase")]
pub struct LoadRewardedAdRequest {
    pub ad_unit_id: String,
}

#[derive(Debug, Clone, Default, Deserialize, Serialize)]
#[serde(rename_all = "camelCase")]
pub struct LoadRewardedAdResponse {
    pub success: bool,
    pub error: Option<String>,
}

#[derive(Debug, Clone, Default, Deserialize, Serialize)]
#[serde(rename_all = "camelCase")]
pub struct IsRewardedAdReadyResponse {
    pub ready: bool,
}

#[derive(Debug, Clone, Default, Deserialize, Serialize)]
#[serde(rename_all = "camelCase")]
pub struct ShowRewardedAdResponse {
    pub success: bool,
    pub rewarded: bool,
    pub reward_amount: Option<i32>,
    pub reward_type: Option<String>,
    pub error: Option<String>,
}
```

### mobile.rs

```rust
use serde::de::DeserializeOwned;
use tauri::{
    plugin::{PluginApi, PluginHandle},
    AppHandle, Runtime,
};
use crate::models::*;

#[cfg(target_os = "ios")]
tauri::ios_plugin_binding!(init_plugin_admob);

pub fn init<R: Runtime, C: DeserializeOwned>(
    _app: &AppHandle<R>,
    api: PluginApi<R, C>,
) -> crate::Result<Admob<R>> {
    #[cfg(target_os = "ios")]
    let handle = api.register_ios_plugin(init_plugin_admob)?;
    Ok(Admob(handle))
}

pub struct Admob<R: Runtime>(PluginHandle<R>);

impl<R: Runtime> Admob<R> {
    pub fn initialize(&self) -> crate::Result<InitializeResponse> {
        self.0.run_mobile_plugin("initialize", ()).map_err(Into::into)
    }

    pub fn load_rewarded_ad(&self, ad_unit_id: String) -> crate::Result<LoadRewardedAdResponse> {
        self.0.run_mobile_plugin("loadRewardedAd",
            LoadRewardedAdRequest { ad_unit_id }).map_err(Into::into)
    }

    pub fn is_rewarded_ad_ready(&self) -> crate::Result<IsRewardedAdReadyResponse> {
        self.0.run_mobile_plugin("isRewardedAdReady", ()).map_err(Into::into)
    }

    pub fn show_rewarded_ad(&self) -> crate::Result<ShowRewardedAdResponse> {
        self.0.run_mobile_plugin("showRewardedAd", ()).map_err(Into::into)
    }
}
```

### build.rsï¼ˆé‡è¦ï¼ï¼‰

```rust
const COMMANDS: &[&str] = &[
    "initialize",
    "load_rewarded_ad",
    "is_rewarded_ad_ready",
    "show_rewarded_ad"
];

fn main() {
    // iOS æ„å»ºæ—¶é“¾æ¥æ¡†æ¶
    let target = std::env::var("TARGET").unwrap_or_default();
    if target.contains("ios") {
        println!("cargo:rustc-link-lib=framework=GoogleMobileAds");
        println!("cargo:rustc-link-lib=framework=UserMessagingPlatform");
    }

    tauri_plugin::Builder::new(COMMANDS)
        .android_path("android")
        .ios_path("ios")
        .build();
}
```

**æ³¨æ„**ï¼š`#[cfg(target_os = "ios")]` åœ¨ build.rs ä¸­ä¸èµ·ä½œç”¨ã€‚å› ä¸º build.rs åœ¨**å®¿ä¸»æœº**ï¼ˆmacOSï¼‰ä¸Šè¿è¡Œï¼Œéœ€è¦ä½¿ç”¨ `std::env::var("TARGET")` æ¥æ£€æŸ¥ç›®æ ‡ã€‚

---

## TypeScript API å®ç°

### guest-js/index.ts

```typescript
import { invoke } from '@tauri-apps/api/core'

export interface InitializeResponse {
  success: boolean;
  message?: string;
}

export interface LoadRewardedAdResponse {
  success: boolean;
  error?: string;
}

export interface IsRewardedAdReadyResponse {
  ready: boolean;
}

export interface ShowRewardedAdResponse {
  success: boolean;
  rewarded: boolean;
  rewardAmount?: number;
  rewardType?: string;
  error?: string;
}

export async function initialize(): Promise<InitializeResponse> {
  return await invoke<InitializeResponse>('plugin:admob|initialize');
}

export async function loadRewardedAd(adUnitId: string = ''): Promise<LoadRewardedAdResponse> {
  return await invoke<LoadRewardedAdResponse>('plugin:admob|load_rewarded_ad', {
    adUnitId,
  });
}

export async function isRewardedAdReady(): Promise<IsRewardedAdReadyResponse> {
  return await invoke<IsRewardedAdReadyResponse>('plugin:admob|is_rewarded_ad_ready');
}

export async function showRewardedAd(): Promise<ShowRewardedAdResponse> {
  return await invoke<ShowRewardedAdResponse>('plugin:admob|show_rewarded_ad');
}
```

---

## å°†æ’ä»¶é›†æˆåˆ°åº”ç”¨

### åœ¨ Cargo.toml ä¸­æ·»åŠ æ’ä»¶

```toml
[dependencies]
tauri-plugin-admob = { path = "../tauri-plugin-admob" }
```

### åœ¨ lib.rs ä¸­æ³¨å†Œæ’ä»¶

```rust
pub fn run() {
    tauri::Builder::default()
        .plugin(tauri_plugin_admob::init())
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

### æƒé™é…ç½®

**src-tauri/capabilities/default.json**:

```json
{
  "permissions": [
    "core:default",
    "admob:default"
  ]
}
```

**tauri-plugin-admob/permissions/default.toml**:

```toml
[default]
description = "Default permissions for the AdMob plugin"
permissions = [
    "allow-initialize",
    "allow-load-rewarded-ad",
    "allow-is-rewarded-ad-ready",
    "allow-show-rewarded-ad"
]
```

### åœ¨ Info.plist ä¸­æ·»åŠ åº”ç”¨ ID

**src-tauri/gen/apple/AppName_iOS/Info.plist**:

```xml
<key>GADApplicationIdentifier</key>
<string>ca-app-pub-XXXXXXXXXXXXXXXX~XXXXXXXXXX</string>
<key>SKAdNetworkItems</key>
<array>
    <dict>
        <key>SKAdNetworkIdentifier</key>
        <string>cstr6suwn9.skadnetwork</string>
    </dict>
</array>
```

---

## åœ¨æ¸¸æˆä¸­ä½¿ç”¨å¹¿å‘Š

### å¹¿å‘Šé…ç½®æ–‡ä»¶

**src/lib/config/admob.ts**:

```typescript
// å¹¿å‘Šå¯ç”¨æ ‡å¿—ï¼ˆå®¡æ ¸é€šè¿‡å‰è®¾ä¸º falseï¼‰
export const ADS_ENABLED = false;

const TEST_AD_UNITS = {
  rewardedAd: 'ca-app-pub-3940256099942544/1712485313',
  appId: 'ca-app-pub-3940256099942544~1458002511',
};

const PRODUCTION_AD_UNITS = {
  rewardedAd: 'ca-app-pub-XXXXXXXX/XXXXXXXXXX',  // å®é™…å¹¿å‘Šå•å…ƒ ID
  appId: 'ca-app-pub-XXXXXXXX~XXXXXXXXXX',       // å®é™…åº”ç”¨ ID
};

const isDevelopment = import.meta.env.DEV;

export const AD_UNITS = isDevelopment ? TEST_AD_UNITS : PRODUCTION_AD_UNITS;
export const isTestMode = isDevelopment;
```

### åœ¨æ¸¸æˆç»“æŸç”»é¢ä¸­ä½¿ç”¨

```typescript
import { AD_UNITS, ADS_ENABLED } from '$lib/config/admob';
import * as admob from 'tauri-plugin-admob-api';

let adLoading = false;
let adError = '';

async function handleWatchAd() {
  if (!ADS_ENABLED) {
    // å¹¿å‘Šç¦ç”¨æ—¶ç›´æ¥ç»­å‘½
    game.startContinue();
    return;
  }

  adLoading = true;
  adError = '';

  try {
    // æ£€æŸ¥å¹¿å‘Šæ˜¯å¦å°±ç»ª
    const readyCheck = await admob.isRewardedAdReady();

    if (!readyCheck.ready) {
      // å¹¿å‘Šæœªå°±ç»ªåˆ™åŠ è½½
      const loadResult = await admob.loadRewardedAd(AD_UNITS.rewardedAd);
      if (!loadResult.success) {
        adError = loadResult.error || 'Failed to load ad';
        adLoading = false;
        return;
      }
    }

    // æ˜¾ç¤ºå¹¿å‘Š
    const showResult = await admob.showRewardedAd();

    if (showResult.rewarded) {
      // è·å¾—å¥–åŠ± - ç»§ç»­æ¸¸æˆ
      game.startContinue();
    } else if (showResult.error) {
      adError = showResult.error;
    }
  } catch (error) {
    adError = String(error);
  } finally {
    adLoading = false;
  }
}
```

---

## æ•…éšœæ’é™¤

### Swift ç±»å‹é”™è¯¯ï¼š"cannot find type 'RewardedAd' in scope"

**åŸå› **ï¼šGoogleMobileAds SDK åŸºäº Objective-Cï¼Œåœ¨ Swift ä¸­éœ€è¦ `GAD` å‰ç¼€ã€‚

```swift
// âŒ é”™è¯¯
private var rewardedAd: RewardedAd?

// âœ… æ­£ç¡®
private var rewardedAd: GADRewardedAd?
```

### é“¾æ¥å™¨é”™è¯¯ï¼š"Undefined symbols for architecture arm64"

**åŸå› **ï¼šGoogleMobileAds æ¡†æ¶æœªé“¾æ¥

**è§£å†³æ–¹æ¡ˆ1**ï¼šåœ¨ä¸»åº”ç”¨ Xcode é¡¹ç›®ä¸­ä¹Ÿæ·»åŠ  SDK

1. æ‰“å¼€ `src-tauri/gen/apple/AppName.xcodeproj`
2. **File â†’ Add Package Dependencies**
3. æ·»åŠ  GoogleMobileAds SDK

**è§£å†³æ–¹æ¡ˆ2**ï¼šåœ¨ build.rs ä¸­é“¾æ¥æ¡†æ¶

```rust
let target = std::env::var("TARGET").unwrap_or_default();
if target.contains("ios") {
    println!("cargo:rustc-link-lib=framework=GoogleMobileAds");
}
```

### Tauri æƒé™é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
admob.is_rewarded_ad_ready not allowed.
Permissions associated with this command: admob:allow-is-rewarded-ad-ready
```

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ `permissions/default.toml` å’Œ `capabilities/default.json` ä¸­æ·»åŠ æƒé™

### å¹¿å‘Šä¸æ˜¾ç¤º

**ç—‡çŠ¶**ï¼šç‚¹å‡»æŒ‰é’®ä½†å¹¿å‘Šä¸æ˜¾ç¤º

**æ£€æŸ¥**ï¼š
1. ç¡®è®¤ä½¿ç”¨çš„æ˜¯æµ‹è¯•å¹¿å‘Š ID
2. ç¡®è®¤ `GADMobileAds.sharedInstance().start()` å·²è°ƒç”¨
3. åœ¨çœŸæœºä¸Šæµ‹è¯•ï¼ˆæ¨¡æ‹Ÿå™¨æ”¯æŒæœ‰é™ï¼‰

---

## å˜ç°ç­–ç•¥æ€è€ƒ

### åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

```mermaid
graph TD
    subgraph Phase1["ç¬¬ä¸€é˜¶æ®µï¼ˆå½“å‰ï¼‰"]
        A[ä»…æ¿€åŠ±ç»­å‘½å¹¿å‘Š]
    end

    subgraph Phase2["ç¬¬äºŒé˜¶æ®µï¼ˆ1ã€œ2ä¸ªæœˆåï¼‰"]
        B[æ·»åŠ æ’é¡µå¹¿å‘Š]
        C[é‡‘å¸ç¿»å€å¹¿å‘Š]
    end

    subgraph Phase3["ç¬¬ä¸‰é˜¶æ®µï¼ˆ3ä¸ªæœˆåï¼‰"]
        D[IAPï¼šç§»é™¤å¹¿å‘Š]
        E[IAPï¼šé‡‘å¸åŒ…]
    end

    Phase1 --> Phase2
    Phase2 --> Phase3
```

### å˜ç°ä¸‰åŸåˆ™

1. **ä¿æŠ¤æ¸¸æˆå¹³è¡¡**ï¼šä»…å¤–è§‚ä»˜è´¹ï¼Œç¦æ­¢èƒ½åŠ›å€¼é”€å”®
2. **å°Šé‡å…è´¹ç©å®¶**ï¼šæ‰€æœ‰å†…å®¹å¯å…è´¹è·å–
3. **ä»·å€¼ä¼˜å…ˆ**ï¼šç”¨æˆ·è§‰å¾—"å€¼å¾—è´­ä¹°"çš„å•†å“

### é¢„æœŸæ”¶ç›Šï¼ˆDAU 10,000 äººåŸºå‡†ï¼‰

| é˜¶æ®µ | å¹¿å‘Šç±»å‹ | æ—¥æ”¶ç›Š | æœˆæ”¶ç›Š |
|------|----------|--------|--------|
| 1 | ä»…æ¿€åŠ± | ã€œ$130 | ã€œ$3,900 |
| 2 | æ¿€åŠ± + æ’é¡µ | ã€œ$425 | ã€œ$12,750 |
| 3 | å¹¿å‘Š + IAP | ã€œ$600 | ã€œ$18,000 |

---

## æ€»ç»“

### ç»éªŒæ•™è®­

1. **ä¿æŒ Tauri CLI æ›´æ–°**ï¼šXCFramework æ”¯æŒç­‰é‡è¦åŠŸèƒ½æŒç»­æ·»åŠ 
2. **ç†è§£ Tauri æ’ä»¶ç»“æ„**ï¼šå¿…é¡»ç†è§£ Rust â†” Swift æ¡¥æ¥
3. **äº¤å‰ç¼–è¯‘**ï¼šbuild.rs ä¸­ HOST vs TARGET çš„åŒºåˆ†å¾ˆé‡è¦
4. **Tauri v2 æƒé™ç³»ç»Ÿ**ï¼šcapabilities å’Œ permissions æ˜¯å¿…éœ€çš„

### æ£€æŸ¥æ¸…å•

- [ ] å‡çº§åˆ°æœ€æ–° Tauri CLIï¼ˆ`cargo install tauri-cli --force`ï¼‰
- [ ] ä½¿ç”¨ `--ios-framework xcode` é€‰é¡¹åˆ›å»ºæ’ä»¶
- [ ] åœ¨**ä¸»åº”ç”¨å’Œæ’ä»¶**ä¸­éƒ½æ·»åŠ  GoogleMobileAds SDK
- [ ] åœ¨ build.rs ä¸­ä½¿ç”¨ `std::env::var("TARGET")` æ£€æµ‹ iOS
- [ ] åœ¨ `permissions/default.toml` ä¸­å®šä¹‰æ‰€æœ‰å‘½ä»¤æƒé™
- [ ] åœ¨ `capabilities/default.json` ä¸­æ·»åŠ  `admob:default`
- [ ] åœ¨ Info.plist ä¸­æ·»åŠ  `GADApplicationIdentifier`
- [ ] åˆ†ç¦»ç®¡ç†æµ‹è¯•/ç”Ÿäº§å¹¿å‘Š ID

### ä¸‹ä¸€æ­¥

- æ·»åŠ  Android æ”¯æŒ
- å®ç°æ’é¡µå¹¿å‘Š
- å®ç°æ¨ªå¹…å¹¿å‘Š
- StoreKit 2 é›†æˆï¼ˆIAPï¼‰

---

## ä¸‹è½½ Shadow Dash

è¯•è¯•ä½¿ç”¨æœ¬æ–‡ä»‹ç»çš„æŠ€æœ¯å¼€å‘çš„ **Shadow Dash** å§ï¼

<a href="https://apps.apple.com/app/shadow-dash/id6740092498" target="_blank" rel="noopener noreferrer">
  <img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg" alt="Download on the App Store" style="height: 40px;" />
</a>

**æ¬¢è¿åé¦ˆï¼** å¦‚æœåœ¨æ¸¸æˆè¿‡ç¨‹ä¸­å‘ç°æ”¹è¿›å»ºè®®æˆ– bugï¼Œè¯·é€šè¿‡ App Store è¯„è®ºæˆ–é‚®ä»¶å‘ŠçŸ¥æˆ‘ä»¬ã€‚

> ğŸ“± **Shadow Dash è¯¦æƒ…**: è®¿é—®[ä½œå“é›†é¡µé¢](/zh/portfolio/shadow-dash)æŸ¥çœ‹æ¸¸æˆæ ¸å¿ƒæœºåˆ¶å’Œæ›´å¤šæˆªå›¾ã€‚

## å‚è€ƒèµ„æ–™

- [Tauri 2.0 å®˜æ–¹æ–‡æ¡£](https://v2.tauri.app/)
- [Google AdMob iOS æ–‡æ¡£](https://developers.google.com/admob/ios/quick-start)
- [Swift Package Manager for Google Mobile Ads](https://github.com/googleads/swift-package-manager-google-mobile-ads)
- [Tauri æ’ä»¶å¼€å‘](https://v2.tauri.app/develop/plugins/)
